<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apex 25K Tracker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: #0a0e1a; color: #e0e6f0; min-height: 100vh; padding: 24px 16px 48px; }

    header { text-align: center; margin-bottom: 28px; }
    header h1 { font-size: 1.8rem; font-weight: 700; color: #fff; letter-spacing: 1px; }
    header p { color: #6b7fa3; font-size: 0.85rem; margin-top: 4px; }

    .summary { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-bottom: 28px; }
    .summary-card { background: #111827; border: 1px solid #1e2d45; border-radius: 12px; padding: 16px 28px; text-align: center; min-width: 160px; }
    .summary-card .label { font-size: 0.75rem; color: #6b7fa3; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 6px; }
    .summary-card .value { font-size: 1.5rem; font-weight: 700; color: #00d68f; }
    .summary-card .value.red { color: #ff4d6a; }
    .summary-card .value.white { color: #fff; }

    /* Quote */
    #quote-banner { max-width:1100px; margin: 0 auto 24px; background: linear-gradient(135deg, #0a1628 0%, #0d1f3c 100%); border: 1px solid #1e3a5f; border-radius: 16px; padding: 28px 36px; text-align: center; position: relative; overflow: hidden; }
    #quote-banner .bg-quote { position:absolute;top:-20px;left:-20px;font-size:8rem;color:#ffffff06;font-family:Georgia,serif;line-height:1; }

    /* Pre-trade checklist */
    .checklist-section { max-width:1100px; margin: 0 auto 24px; background: #111827; border: 1px solid #1e3a5f; border-radius: 16px; padding: 20px 28px; }
    .checklist-section h3 { font-size: 0.95rem; font-weight: 700; color: #fff; margin-bottom: 16px; display:flex; align-items:center; gap:8px; cursor:pointer; user-select:none; }
    .checklist-section h3 .toggle { color:#6b7fa3; font-size:0.75rem; margin-left:auto; }
    .checklist-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
    .check-item { display:flex; align-items:center; gap:10px; background:#0d1424; border-radius:10px; padding:12px 14px; cursor:pointer; border:1px solid #1e2d45; transition: border-color 0.2s, background 0.2s; }
    .check-item.checked { background:#081a10; border-color:#00d68f44; }
    .check-item input[type=checkbox] { display:none; }
    .check-box { width:18px; height:18px; border:2px solid #2a3f5f; border-radius:4px; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition: all 0.2s; }
    .check-item.checked .check-box { background:#00d68f; border-color:#00d68f; }
    .check-box-tick { color:#fff; font-size:11px; display:none; }
    .check-item.checked .check-box-tick { display:block; }
    .check-label { font-size:0.85rem; color:#c0cedf; }
    .check-item.checked .check-label { color:#00d68f; }
    .checklist-status { margin-top:12px; font-size:0.8rem; color:#6b7fa3; text-align:center; }
    .checklist-status.all-clear { color:#00d68f; font-weight:600; }

    /* Accounts */
    .accounts { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; max-width: 1100px; margin: 0 auto; }
    .account-card { background: #111827; border: 1px solid #1e2d45; border-radius: 16px; padding: 24px; }
    .account-card.ready { border-color: #00d68f55; box-shadow: 0 0 24px #00d68f18; }
    .account-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .account-name { font-size: 1.1rem; font-weight: 700; color: #fff; }
    .payout-badge { background: #00d68f22; color: #00d68f; border: 1px solid #00d68f44; border-radius: 20px; font-size: 0.72rem; font-weight: 600; padding: 3px 10px; display: none; }
    .payout-badge.show { display: inline-block; }
    .balance-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
    .balance { font-size: 1.8rem; font-weight: 700; color: #fff; }
    .pnl-today { font-size: 0.9rem; font-weight: 600; }
    .pnl-today.pos { color: #00d68f; } .pnl-today.neg { color: #ff4d6a; } .pnl-today.zero { color: #6b7fa3; }
    .progress-section { margin: 16px 0; }
    .progress-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: #6b7fa3; margin-bottom: 6px; }
    .progress-bar { background: #1e2d45; border-radius: 6px; height: 8px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 6px; background: linear-gradient(90deg, #0066ff, #00d68f); transition: width 0.4s ease; }
    .stats-row { display: flex; gap: 12px; margin: 16px 0; }
    .stat-box { flex: 1; background: #0d1424; border: 1px solid #1e2d45; border-radius: 10px; padding: 10px; text-align: center; }
    .stat-box .stat-label { font-size: 0.68rem; color: #6b7fa3; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 4px; }
    .stat-box .stat-value { font-size: 1.15rem; font-weight: 700; color: #fff; }
    .stat-box .stat-value.green { color: #00d68f; } .stat-box .stat-value.yellow { color: #f5c542; } .stat-box .stat-value.red { color: #ff4d6a; }

    /* Log section */
    .log-section { margin-top: 16px; }
    .log-title { font-size: 0.75rem; color: #6b7fa3; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 10px; }
    .log-entries { max-height: 180px; overflow-y: auto; margin-bottom: 12px; }
    .log-entry { padding: 8px 0; border-bottom: 1px solid #1a2540; font-size: 0.82rem; }
    .log-entry:last-child { border-bottom: none; }
    .log-entry-top { display:flex; justify-content: space-between; align-items: center; }
    .log-entry .date { color: #6b7fa3; }
    .log-entry .amount { font-weight: 600; }
    .log-entry .amount.pos { color: #00d68f; } .log-entry .amount.neg { color: #ff4d6a; }
    .log-entry .delete-btn { background: none; border: none; color: #ff4d6a44; cursor: pointer; font-size: 0.8rem; padding: 2px 6px; border-radius: 4px; transition: color 0.2s; }
    .log-entry .delete-btn:hover { color: #ff4d6a; }
    .log-entry .emotion-row { margin-top:4px; font-size:0.75rem; color:#6b7fa3; }
    .log-entry .notes-text { margin-top:3px; font-size:0.75rem; color:#4d6a8a; font-style:italic; }
    .log-empty { color: #3a4f6b; font-size: 0.8rem; text-align: center; padding: 12px 0; }

    /* Journal input */
    .journal-section { background:#0d1424; border:1px solid #1e2d45; border-radius:10px; padding:14px; margin-bottom:10px; }
    .journal-section .journal-label { font-size:0.72rem; color:#6b7fa3; text-transform:uppercase; letter-spacing:0.6px; margin-bottom:10px; }
    .emotion-row { display:flex; gap:8px; margin-bottom:10px; }
    .emotion-btn { background:none; border:1px solid #1e2d45; border-radius:8px; padding:6px 10px; font-size:1.2rem; cursor:pointer; transition:all 0.2s; }
    .emotion-btn:hover { border-color:#4d9fff44; background:#0a1628; }
    .emotion-btn.selected { border-color:#4d9fff; background:#0a1628; }
    .notes-input { width:100%; background:#0a0e1a; border:1px solid #1e2d45; border-radius:8px; color:#c0cedf; font-size:0.82rem; padding:8px 10px; outline:none; resize:none; height:52px; transition:border-color 0.2s; }
    .notes-input:focus { border-color:#0066ff; }
    .notes-input::placeholder { color:#3a4f6b; }

    .input-row { display: flex; gap: 8px; }
    .pnl-input { flex: 1; background: #0d1424; border: 1px solid #1e2d45; border-radius: 8px; color: #fff; font-size: 0.9rem; padding: 9px 12px; outline: none; transition: border-color 0.2s; }
    .pnl-input:focus { border-color: #0066ff; }
    .pnl-input::placeholder { color: #3a4f6b; }
    .log-btn { background: #0066ff; border: none; border-radius: 8px; color: #fff; cursor: pointer; font-size: 0.85rem; font-weight: 600; padding: 9px 16px; transition: background 0.2s; white-space: nowrap; }
    .log-btn:hover { background: #0052cc; }
    .reset-btn { background: none; border: 1px solid #1e2d45; border-radius: 8px; color: #6b7fa3; cursor: pointer; font-size: 0.75rem; padding: 5px 10px; margin-top: 10px; transition: all 0.2s; }
    .reset-btn:hover { border-color: #ff4d6a44; color: #ff4d6a; }

    /* Rules sections */
    .rules-section { max-width: 1100px; margin: 24px auto 0; background: #111827; border: 1px solid #1e2d45; border-radius: 16px; padding: 28px 32px; }
    .rules-section h3 { font-size: 1rem; color: #fff; font-weight: 700; letter-spacing: 0.5px; margin-bottom: 20px; }
    .rules-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 14px; }
    .rule-item { background: #0d1424; border-radius: 10px; padding: 16px 18px; font-size: 0.9rem; }
    .rule-item .rule-label { color: #6b7fa3; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 6px; }
    .rule-item .rule-value { color: #e0e6f0; font-weight: 700; font-size: 1rem; }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #1e2d45; border-radius: 4px; }
  </style>
</head>
<body>

<header>
  <h1>âš¡ Apex 25K Tracker</h1>
  <p>3 MNQ Â· $200/day target Â· 8 days to payout</p>
  <p style="margin-top:6px;font-size:0.8rem;" id="sync-status">ðŸ”„ Connectingâ€¦</p>
</header>

<!-- Summary Stats -->
<div class="summary">
  <div class="summary-card">
    <div class="label">Total Profit</div>
    <div class="value" id="total-profit">$0</div>
  </div>
  <div class="summary-card">
    <div class="label">Ready to Pay Out</div>
    <div class="value white" id="ready-count">0 / 3</div>
  </div>
  <div class="summary-card">
    <div class="label">Payout Available</div>
    <div class="value" id="payout-available">$0</div>
  </div>
</div>

<!-- Daily Quote -->
<div id="quote-banner">
  <div class="bg-quote">"</div>
  <div id="quote-text" style="font-size:1.25rem;font-weight:600;color:#fff;line-height:1.6;position:relative;z-index:1;"></div>
  <div id="quote-author" style="margin-top:10px;font-size:0.8rem;color:#4d9fff;letter-spacing:1px;text-transform:uppercase;"></div>
</div>

<!-- Pre-Trade Checklist -->
<div class="checklist-section">
  <h3 onclick="toggleChecklist()">
    âœ… Pre-Trade Checklist
    <span class="toggle" id="checklist-toggle">â–¼ expand</span>
  </h3>
  <div id="checklist-body" style="display:none;">
    <div class="checklist-grid" id="checklist-grid"></div>
    <div class="checklist-status" id="checklist-status">0 / 5 checked</div>
    <button onclick="resetChecklist()" style="margin-top:10px;background:none;border:1px solid #1e2d45;border-radius:6px;color:#6b7fa3;cursor:pointer;font-size:0.72rem;padding:4px 10px;">Reset Checklist</button>
  </div>
</div>

<!-- Account Cards -->
<div class="accounts" id="accounts-container"></div>

<!-- Rules to Follow -->
<div class="rules-section" style="margin-bottom:20px; border-color:#1e3a5f;">
  <h3>ðŸ“‹ Rules to Follow</h3>
  <div class="rules-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
    <div class="rule-item" style="border-left:4px solid #0066ff; background:#0a1628;">
      <div class="rule-label">Daily Target</div>
      <div class="rule-value" style="color:#4d9fff; font-size:1.1rem;">Hit $200 and stop</div>
    </div>
    <div class="rule-item" style="border-left:4px solid #ff4d6a; background:#1a0d12;">
      <div class="rule-label">Loss Limit</div>
      <div class="rule-value" style="color:#ff6b80; font-size:1.1rem;">Stop after 2 losses in a row</div>
    </div>
    <div class="rule-item" style="border-left:4px solid #f5c542; background:#1a1608;">
      <div class="rule-label">Patience</div>
      <div class="rule-value" style="color:#f5c542; font-size:1.1rem;">Wait for the right trade</div>
    </div>
    <div class="rule-item" style="border-left:4px solid #f5c542; background:#1a1608;">
      <div class="rule-label">Market Open</div>
      <div class="rule-value" style="color:#f5c542; font-size:1.1rem;">Avoid first 30 min</div>
    </div>
    <div class="rule-item" style="border-left:4px solid #00d68f; background:#081a12;">
      <div class="rule-label">Session</div>
      <div class="rule-value" style="color:#00d68f; font-size:1.1rem;">NY session only</div>
    </div>
  </div>
</div>

<!-- Apex Rules -->
<div class="rules-section">
  <h3>25K Account Rules Â· 3 MNQ</h3>
  <div class="rules-grid">
    <div class="rule-item"><div class="rule-label">Profit Target</div><div class="rule-value">$1,500</div></div>
    <div class="rule-item"><div class="rule-label">Trailing Threshold</div><div class="rule-value">$1,500</div></div>
    <div class="rule-item"><div class="rule-label">Safety Net</div><div class="rule-value">$26,600 balance</div></div>
    <div class="rule-item"><div class="rule-label">Daily Profit Limit</div><div class="rule-value">$450 max/day</div></div>
    <div class="rule-item"><div class="rule-label">Max Open Loss</div><div class="rule-value">-$450 at any time</div></div>
    <div class="rule-item"><div class="rule-label">Min Profitable Days</div><div class="rule-value">5 days ($50+ each)</div></div>
    <div class="rule-item"><div class="rule-label">Min Calendar Days</div><div class="rule-value">8 days in PA</div></div>
    <div class="rule-item"><div class="rule-label">3 MNQ = $/point</div><div class="rule-value">$6 per NQ point</div></div>
    <div class="rule-item"><div class="rule-label">Points for $200</div><div class="rule-value">~33 NQ points</div></div>
    <div class="rule-item"><div class="rule-label">Min Payout</div><div class="rule-value">$500</div></div>
  </div>
</div>

<script>
  const STARTING_BALANCE = 25000, SAFETY_NET = 26600, PROFIT_TARGET = 1500;
  const DAILY_MAX = 450, MIN_GREEN_DAYS = 5, MIN_GREEN_DAY_AMOUNT = 50;
  const MIN_CALENDAR_DAYS = 8, MIN_PAYOUT = 500;

  const CHECKLIST_ITEMS = [
    'Waited past the first 30 min of open?',
    'Trading in NY session hours only?',
    'No more than 2 losses in a row today?',
    'Not chasing the market â€” waiting for MY setup?',
    'I accept the risk of this trade before I enter?',
  ];

  const EMOTIONS = ['ðŸ˜¤','ðŸ˜Ÿ','ðŸ˜','ðŸ™‚','ðŸ˜Ž'];
  const EMOTION_LABELS = ['Frustrated','Anxious','Neutral','Good','Locked In'];

  const API_URL = 'https://layers-cleaning-lucky-wife.trycloudflare.com';
  const API_KEY = '526d6f7ad5c616d1d4dd8670ec631ff9';

  function initData() {
    return { accounts: [
      { name: 'Account 1', entries: [], startDate: null },
      { name: 'Account 2', entries: [], startDate: null },
      { name: 'Account 3', entries: [], startDate: null },
    ]};
  }
  function loadData() {
    try { return JSON.parse(localStorage.getItem('apex-tracker-v2')) || initData(); }
    catch { return initData(); }
  }
  function saveData(d) {
    localStorage.setItem('apex-tracker-v2', JSON.stringify(d));
    setSyncStatus('syncing');
    fetch(`${API_URL}/data`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'x-api-key': API_KEY },
      body: JSON.stringify(d)
    }).then(r => r.ok ? setSyncStatus('ok') : setSyncStatus('error'))
      .catch(() => setSyncStatus('error'));
  }
  function setSyncStatus(state) {
    const el = document.getElementById('sync-status');
    if (!el) return;
    const map = { ok: ['ðŸŸ¢ Synced', '#00d68f'], syncing: ['ðŸ”„ Savingâ€¦', '#f5c542'], error: ['ðŸ”´ Offline â€” local only', '#ff4d6a'] };
    const [text, color] = map[state] || map.error;
    el.textContent = text; el.style.color = color;
  }
  async function syncFromServer() {
    try {
      const r = await fetch(`${API_URL}/data`, { headers: { 'x-api-key': API_KEY } });
      if (!r.ok) throw new Error();
      const data = await r.json();
      localStorage.setItem('apex-tracker-v2', JSON.stringify(data));
      setSyncStatus('ok');
      render();
    } catch { setSyncStatus('error'); }
  }

  function loadChecklist() {
    try { return JSON.parse(localStorage.getItem('apex-checklist-v1')) || {}; }
    catch { return {}; }
  }
  function saveChecklist(d) { localStorage.setItem('apex-checklist-v1', JSON.stringify(d)); }

  function formatCurrency(v) {
    const s = '$' + Math.abs(v).toLocaleString('en-US', {minimumFractionDigits:0, maximumFractionDigits:2});
    return v < 0 ? '-'+s : s;
  }
  function formatDate(iso) {
    return new Date(iso).toLocaleDateString('en-US', {month:'short', day:'numeric'});
  }
  function getTodayISO() { return new Date().toISOString().slice(0,10); }

  function getAccountStats(account) {
    const entries = account.entries || [];
    const totalPnl = entries.reduce((s,e) => s+e.amount, 0);
    const balance = STARTING_BALANCE + totalPnl;
    const greenDays = entries.filter(e => e.amount >= MIN_GREEN_DAY_AMOUNT).length;
    const calendarDays = account.startDate
      ? Math.floor((Date.now() - new Date(account.startDate)) / 86400000) + 1 : 0;
    const safetyNetReached = balance >= SAFETY_NET;
    const payoutReady = safetyNetReached && greenDays >= MIN_GREEN_DAYS && calendarDays >= MIN_CALENDAR_DAYS;
    const todayEntry = entries.find(e => e.date === getTodayISO());
    const progressPct = Math.min(100, Math.max(0, (totalPnl / PROFIT_TARGET) * 100));
    return { totalPnl, balance, greenDays, calendarDays, safetyNetReached, payoutReady, todayEntry, progressPct, entries };
  }

  function renderAccount(account, index) {
    const s = getAccountStats(account);
    const card = document.createElement('div');
    card.className = 'account-card' + (s.payoutReady ? ' ready' : '');

    const greenDayClass = s.greenDays >= MIN_GREEN_DAYS ? 'green' : s.greenDays >= 3 ? 'yellow' : 'white';
    const calDayClass = s.calendarDays >= MIN_CALENDAR_DAYS ? 'green' : s.calendarDays >= 5 ? 'yellow' : 'white';
    const balanceColor = s.balance >= SAFETY_NET ? '#00d68f' : '#fff';

    let todayText = 'No entry today', todayClass = 'zero';
    if (s.todayEntry) {
      todayText = (s.todayEntry.amount >= 0 ? '+' : '') + formatCurrency(s.todayEntry.amount) + ' today';
      todayClass = s.todayEntry.amount >= 0 ? 'pos' : 'neg';
    }

    const entriesHtml = s.entries.length === 0
      ? '<div class="log-empty">No entries yet â€” log your first day!</div>'
      : [...s.entries].reverse().map(e => {
          const emotionLabel = e.emotion !== undefined ? EMOTIONS[e.emotion] + ' ' + EMOTION_LABELS[e.emotion] : '';
          const notesHtml = e.notes ? `<div class="notes-text">"${e.notes}"</div>` : '';
          const emotionHtml = emotionLabel ? `<div class="emotion-row">${emotionLabel}</div>` : '';
          return `<div class="log-entry">
            <div class="log-entry-top">
              <span class="date">${formatDate(e.date)}</span>
              <span class="amount ${e.amount >= 0 ? 'pos' : 'neg'}">${e.amount >= 0 ? '+' : ''}${formatCurrency(e.amount)}</span>
              <button class="delete-btn" onclick="deleteEntry(${index}, '${e.date}')">âœ•</button>
            </div>
            ${emotionHtml}${notesHtml}
          </div>`;
        }).join('');

    // Emotion buttons
    const emotionBtns = EMOTIONS.map((e,i) =>
      `<button class="emotion-btn" id="emo-${index}-${i}" onclick="selectEmotion(${index}, ${i})" title="${EMOTION_LABELS[i]}">${e}</button>`
    ).join('');

    card.innerHTML = `
      <div class="account-header">
        <span class="account-name">${account.name}</span>
        <span class="payout-badge ${s.payoutReady ? 'show' : ''}">âœ“ PAYOUT READY</span>
      </div>
      <div class="balance-row">
        <span class="balance" style="color:${balanceColor}">$${s.balance.toLocaleString()}</span>
        <span class="pnl-today ${todayClass}">${todayText}</span>
      </div>
      <div class="progress-section">
        <div class="progress-label"><span>Safety Net Progress</span><span>${formatCurrency(s.totalPnl)} / $1,500</span></div>
        <div class="progress-bar"><div class="progress-fill" style="width:${s.progressPct}%"></div></div>
      </div>
      <div class="stats-row">
        <div class="stat-box"><div class="stat-label">Green Days</div><div class="stat-value ${greenDayClass}">${s.greenDays} <span style="font-size:0.7rem;color:#6b7fa3">/ ${MIN_GREEN_DAYS}</span></div></div>
        <div class="stat-box"><div class="stat-label">Calendar Days</div><div class="stat-value ${calDayClass}">${s.calendarDays} <span style="font-size:0.7rem;color:#6b7fa3">/ ${MIN_CALENDAR_DAYS}</span></div></div>
        <div class="stat-box"><div class="stat-value ${s.totalPnl >= 0 ? 'green' : 'red'}">${s.totalPnl >= 0 ? '+' : ''}${formatCurrency(s.totalPnl)}</div><div class="stat-label">Total P&L</div></div>
      </div>
      <div class="log-section">
        <div class="log-title">Session Journal & Log</div>
        <div class="log-entries">${entriesHtml}</div>
        <div class="journal-section">
          <div class="journal-label">How are you feeling today?</div>
          <div class="emotion-row" id="emotion-row-${index}">${emotionBtns}</div>
          <textarea class="notes-input" id="notes-${index}" placeholder="Session notes... (what worked, what didn't, mindset)"></textarea>
        </div>
        <div class="input-row" style="margin-top:10px;">
          <input class="pnl-input" type="number" id="input-${index}" placeholder="+200 or -150" step="1" />
          <button class="log-btn" onclick="logEntry(${index})">Log Day</button>
        </div>
        <button class="reset-btn" onclick="resetAccount(${index})">Reset Account</button>
      </div>
    `;
    return card;
  }

  // Track selected emotion per account
  const selectedEmotions = {};

  window.selectEmotion = function(accountIndex, emoIndex) {
    selectedEmotions[accountIndex] = emoIndex;
    EMOTIONS.forEach((_,i) => {
      const btn = document.getElementById(`emo-${accountIndex}-${i}`);
      if (btn) btn.classList.toggle('selected', i === emoIndex);
    });
  };

  function render() {
    const data = loadData();
    const container = document.getElementById('accounts-container');
    container.innerHTML = '';
    let totalPnl = 0, readyCount = 0;
    data.accounts.forEach((account, i) => {
      const s = getAccountStats(account);
      totalPnl += s.totalPnl;
      if (s.payoutReady) readyCount++;
      container.appendChild(renderAccount(account, i));
    });
    document.getElementById('total-profit').textContent = (totalPnl >= 0 ? '+' : '') + formatCurrency(totalPnl);
    document.getElementById('total-profit').style.color = totalPnl >= 0 ? '#00d68f' : '#ff4d6a';
    document.getElementById('ready-count').textContent = readyCount + ' / 3';
    document.getElementById('payout-available').textContent = formatCurrency(readyCount * MIN_PAYOUT);
    document.getElementById('payout-available').style.color = readyCount > 0 ? '#00d68f' : '#6b7fa3';
    renderChecklist();
  }

  window.logEntry = function(index) {
    const input = document.getElementById('input-' + index);
    const val = parseFloat(input.value);
    if (isNaN(val)) { input.focus(); return; }
    const notes = document.getElementById('notes-' + index).value.trim();
    const emotion = selectedEmotions[index];
    const data = loadData();
    const account = data.accounts[index];
    const today = getTodayISO();
    if (!account.startDate) account.startDate = today;
    const existing = account.entries.findIndex(e => e.date === today);
    const entry = { date: today, amount: val, notes: notes || '', emotion: emotion !== undefined ? emotion : null };
    if (existing >= 0) account.entries[existing] = entry;
    else account.entries.push(entry);
    account.entries.sort((a,b) => a.date.localeCompare(b.date));
    saveData(data);
    input.value = '';
    delete selectedEmotions[index];
    render();
  };

  window.deleteEntry = function(index, date) {
    const data = loadData();
    data.accounts[index].entries = data.accounts[index].entries.filter(e => e.date !== date);
    if (data.accounts[index].entries.length === 0) data.accounts[index].startDate = null;
    saveData(data); render();
  };

  window.resetAccount = function(index) {
    if (!confirm('Reset this account? All entries will be deleted.')) return;
    const data = loadData();
    data.accounts[index] = { name: data.accounts[index].name, entries: [], startDate: null };
    saveData(data); render();
  };

  // Checklist
  function renderChecklist() {
    const cl = loadChecklist();
    const grid = document.getElementById('checklist-grid');
    if (!grid) return;
    grid.innerHTML = CHECKLIST_ITEMS.map((item, i) => {
      const checked = !!cl[i];
      return `<div class="check-item ${checked ? 'checked' : ''}" onclick="toggleCheck(${i})">
        <div class="check-box"><span class="check-box-tick">âœ“</span></div>
        <span class="check-label">${item}</span>
      </div>`;
    }).join('');
    const count = Object.values(cl).filter(Boolean).length;
    const status = document.getElementById('checklist-status');
    status.textContent = count === CHECKLIST_ITEMS.length ? 'âœ… All clear â€” you\'re good to trade.' : `${count} / ${CHECKLIST_ITEMS.length} checked`;
    status.className = 'checklist-status' + (count === CHECKLIST_ITEMS.length ? ' all-clear' : '');
  }

  window.toggleCheck = function(i) {
    const cl = loadChecklist();
    cl[i] = !cl[i];
    saveChecklist(cl);
    renderChecklist();
  };

  window.resetChecklist = function() {
    saveChecklist({});
    renderChecklist();
  };

  window.toggleChecklist = function() {
    const body = document.getElementById('checklist-body');
    const toggle = document.getElementById('checklist-toggle');
    const open = body.style.display !== 'none';
    body.style.display = open ? 'none' : 'block';
    toggle.textContent = open ? 'â–¼ expand' : 'â–² collapse';
  };

  // Daily quote
  const quotes = [
    { text: "The best traders have no ego. You have to swallow your pride and get out of the losses.", author: "Mark Douglas" },
    { text: "If you can learn to create a state of mind that is not affected by the market's behavior, the struggle will cease to exist.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "The market doesn't know you exist. You can do nothing to influence it. You can only control your beliefs, your interpretations, and your behavior.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "To whatever degree you haven't accepted the risk, is the same degree to which you will avoid the pain of a loss by rationalizing, hesitating, or not following your rules.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "Think of it this way: if you were able to trade without any emotional discomfort, how would your trading be different? The answer is: you would follow your rules.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "The consistency you seek is in your mind, not in the markets. It's your thinking that needs to be consistent, not the markets.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "Every moment in the market is unique. Past results â€” good or bad â€” have no bearing on the next trade. Each trade stands alone.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "The market is always right. All it can do is generate information about itself. Your job is to perceive that information without distortion.", author: "Mark Douglas â€” The Disciplined Trader" },
    { text: "When you genuinely accept the risks, you will be at peace with any outcome. There is nothing to defend, nothing to protect.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "Amateur traders look for a sure thing. Professionals learn to think in probabilities. There are no sure things â€” only edges that play out over a series of trades.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "The hard right edge is always uncertain. Your job isn't to predict what happens. Your job is to respond correctly when it does.", author: "Mark Douglas" },
    { text: "Size down until you feel nothing. When you feel nothing, you'll execute perfectly. Then size back up slowly.", author: "Mark Douglas" },
    { text: "You don't need to know what's going to happen next in order to make money. You just need an edge and the discipline to let it play out.", author: "Mark Douglas â€” Trading in the Zone" },
    { text: "The pain of losing is far greater than the pleasure of winning â€” unless you train your mind to experience them as equals.", author: "Mark Douglas â€” The Disciplined Trader" },
    { text: "Small size, clear rules, consistent execution. That's the foundation everything else is built on.", author: "Mark Douglas" },
  ];

  const dayIndex = Math.floor(Date.now() / 86400000) % quotes.length;
  const q = quotes[dayIndex];
  document.getElementById('quote-text').textContent = '\u201C' + q.text + '\u201D';
  document.getElementById('quote-author').textContent = 'â€” ' + q.author;

  render();
  syncFromServer(); // pull latest from server on load
</script>
</body>
</html>
